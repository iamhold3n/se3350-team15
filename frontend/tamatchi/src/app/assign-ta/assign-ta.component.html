<h2>TA Assignment</h2>

<!--Message if not logged in-->
<span *ngIf = "!loggedIn">Please log in to view TA assignments</span>

<!-- '#courses' assigns the name 'courses' to this select element -->
<label *ngIf="loggedIn" for="courses">Select a Course</label>
<select *ngIf="loggedIn" #courses (change)="courseView(courses.value)" id="courses">
    <option value="-1">{{empty_course}}</option>
    <option *ngFor="let c of course_list, index as a" value="{{a}}">{{c}}</option>
</select>

<span *ngIf="!courseLoaded(viewed_course)" >Loading...</span>

<button *ngIf="viewed_course != empty_course" (click)="saveChanges()" class="confirm">Save Changes to ALL Courses</button>

<!--TWO main columns will hold the list of assigned and unassigned TAs-->
<table *ngIf="loggedIn && viewed_course != empty_course">
    <tr>
        <th>
            <div>Assigned TAS</div>

            <div>{{courseHrs(viewed_course)}} total TA Hours</div>
            <div>{{totalViewedHrs()}} Hours filled</div>

        </th>
        <th>
            <div>Unassigned TAS</div>
        </th>
        <th>
            Matching Tools
        </th>        
    </tr>
    <!-- For admin-level users-->
    <tr *ngIf = "admin" cdkDropListGroup>
        <td>
            <!-- Draggable list for assigned TAs -->
            <!-- Accepts incoming list items -->
            
            <div cdkDropList (cdkDropListDropped)="drop($event,true)">
                <div id="assigned" cdkDrag *ngFor='let ta of viewed_assigned, index as a'>

                    <!--Proffessor's ranking number-->
                    <div class="number" >{{ta.prof_rank}}</div>
                    <!--assigned TA details-->
                    <div class="list" >{{ta.email}}</div>

                    <button (click)= "toggle_expand(true, viewedIndex(),a)">DETAILS</button>
                    <!--EXPANDED VIEW-->
                    <div *ngIf="expanded_ta[0][viewedIndex()][a]" >
                        <div class="list" >Status Code: {{ta.status}}</div>
                        <div class="list" >Received Hours: {{ta.hrs}}</div>
                        <div >
                            Ranked Courses:
                            <div class="list" *ngFor="let crs of ta.course, index as n">
                                <!--TA's ranking number-->
                                <div class="number" >{{n+1}}</div>
                                {{crs}}
                            </div>
                        </div>
                        <br>
                    </div>
                    <!--END OF EXPANDED VIEW-->

                </div>
            </div>
        </td>
        <td>
            <!-- Draggable list for unassigned TAs -->
            <!-- Accepts incoming list items -->
            <div cdkDropList (cdkDropListDropped)="drop($event,false)">
                <div id="unassigned" cdkDrag *ngFor='let ta of viewed_unassigned, index as a'>
                    
                    <!--Proffessor's ranking number-->
                    <div class="number" >{{ta.prof_rank}}</div>
                    <!--assigned TA details-->
                    <div class="list" >{{ta.email}}</div>
                    <div *ngIf="isAssigned(ta)">ALREADY ASSIGNED TO DIFFERENT COURSE</div>

                    <button (click)= "toggle_expand(false, viewedIndex(),a)">DETAILS</button>

                    <!--EXPANDED VIEW-->
                    <div *ngIf="expanded_ta[1][viewedIndex()][a]" >
                        <div class="list" >Status Code: {{ta.status}}</div>
                        <div class="list" >Prospective Hours: {{ta.hrs}}</div>
                        <div >
                            Ranked Courses:
                            <div class="list" *ngFor="let crs of ta.course, index as n">
                                <!--TA's ranking number-->
                                <div class="number" >{{n+1}}</div>
                                {{crs}}
                            </div>
                        </div>
                        <br>
                    </div>
                    <!--END OF EXPANDED VIEW-->
                    

                </div>
            </div>
        </td>
        <td>

            <!--Auto-Assign Buttons-->
            <button (click)="autoAssign(viewed_course)">Auto-Assign TAs for {{viewed_course}}</button>
            <button (click)="autoAssignAll()">Auto-Assign TAs for ALL COURSES</button>

            <!--Radio buttons to toggle which ranking takes priority-->
            <!--Assume page initializes with prof ranking taking priority-->
            <span>Which ranking should take priority?</span>
            <input type="radio" id="prof-first" name="rank-priority" checked (change)="prof_rank_first=true">
            <label for="prof-first">Professor's Rankings</label><br>

            <input type="radio" id="ta-first" name="rank-priority" (change)="prof_rank_first=false">
            <label for="ta-first">TA's Rankings</label><br>

            <!--Clear assignment buttons-->
            <button (click)="clearAssign(viewed_course)">Clear Assigned TAs for {{viewed_course}}</button>
            <button (click)="clearAll()">Clear Assigned TAs for ALL COURSES</button>

            <!--Insert NEW TA editor-->
            <app-insert-ta 
                [course_list]="course_list" 
                [all_unassigned]="all_unassigned" 
                (new_unassigned) = "insertTA($event)"
            ></app-insert-ta>


        </td>
    </tr>

    <!-- For professor-level users-->
    <tr *ngIf = "professor">
        <td>
            <div id="assigned" *ngFor='let ta of viewed_assigned, index as a'>

                <!--Proffessor's ranking number-->
                <div class="number" >{{ta.prof_rank}}</div>
                <!--assigned TA details-->
                <div class="list" >{{ta.email}}</div>

                <!--Buttons for professoers to accept/reject the assignemnt-->
                <div *ngIf="all_feedback[viewedIndex()][a] != 'reject' && all_feedback[viewedIndex()][a] != 'accept' ">Please Accept or Reject this assignment</div>
                <label for = "accept" *ngIf="all_feedback[viewedIndex()][a] == 'reject' ">You have rejected this assignment</label>
                <button id="accept" *ngIf="all_feedback[viewedIndex()][a] != 'accept' " (click)= "all_feedback[viewedIndex()][a] = 'accept'">ACCEPT</button>
                <label for = "reject" *ngIf="all_feedback[viewedIndex()][a] == 'accept' ">You have accepted this assignment</label>
                <button id="reject" *ngIf="all_feedback[viewedIndex()][a] != 'reject' " (click)= "all_feedback[viewedIndex()][a] = 'reject'">REJECT</button>

            </div>
            
        </td>
        <td>

            <div id="unassigned" *ngFor='let ta of viewed_unassigned, index as a'>

                <!--Proffessor's ranking number-->
                <div class="number" >{{ta.prof_rank}}</div>
                <!--assigned TA details-->
                <div class="list" >{{ta.email}}</div>
            </div>

        </td>
    </tr>

    <br>

</table>


